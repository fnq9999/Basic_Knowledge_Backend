持久化
====

### AOF
- ![](.持久化_images/ba440a20.png)
- 特点  
    - 以追加方式记录服务器收到的每一个写操作记录到文件中
    - 存储按照RESP协议来存
    - 服务启动时，这些记录的操作逐条执行，从而重建原来数据
    
### RDB
- ![](.持久化_images/606736c0.png)
- 特点
    - 特定时间间隔保存快照，到磁盘
    - 文件格式紧凑，体积小，恢复更快  
    -  两种命令来完成
      - save:会阻塞当前服务进程,直到RDB创建完成
      - bgsave :fork子进程，由子进程完成RDB文件创建
        - 好处：
          - 通过fork创建出来的子进程拥有父进程同样的内存空间，父进程对内存的修改，子进程没有感知，互不影响
          - fork创建子进程时，不会立刻触发大量内存拷贝带来的，避免大量拷贝内存带来的影响
### 比较
- 当Redis重启时候，AOF恢复优先，这是因为aof恢复完整度高
    - 因为RDB不可能较频繁创建
- AOF缺点是文件体积过大
- RDB备份时间较长，但是产生的文件小，方便进行容灾备份和主从备份

