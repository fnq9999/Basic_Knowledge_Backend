并发
=====

### 锁
- 最佳实践
    - 减少持有时间，缩小临界区
    - 优化锁的粒度
    - 读写分离:使用读写锁
    - 原子操作
    
- BadCase
    - 忽略锁的可重入性
    - golang总使用race detector 发现问题
- 追求极致
    - golang
        - Mutex太慢
        - 读写锁能优化一些
        - 原子操作虽然快，单没到极致  
        - UnsafePointer最快，只有一条方寸指令
    
- 锁演变
    - 80386处理器，只需要关闭中断，就能实现原子操作，但是需要进入内核态，所以性能
    不好
    - Lock+CMPSWAP(Lock 前缀锁定内存总线，内存总线为瓶颈)
    - P4 系列CPU：MESI 缓存一致性协议:锁的粒度->CacheLine
    - 自旋锁
    - Mutex:
        - golang:效率优先，兼顾公平