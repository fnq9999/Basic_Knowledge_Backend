概念
====



### 为什么需要虚拟内存技术 
- 参考[cpu 为什么要使用虚拟地址空间与物理地址空间映射？解决了什么样的问题？](https://www.zhihu.com/question/20696698)
- 简单对比
  - 直接使用实模式，没有权限管理，任何程序可以访问任何物理内存位置
  - 使用保护模式，使用段描述符表，实现了权限管理
    每个程序内能访问自己有权限的段。但不方便内存的动态分配
  - 使用页式内存管理 ，既实现在权限管理，也实现了内存的动态管理分配。
    页式的虚拟内存方式。  


top中的三种内存概念
=====

### 虚拟内存
- 只要是进程申请过的内存，都算在内
### 常驻内存
- 实际使用的物理内存大小，不包括swap和share
    - swap是在磁盘中的内存部分
### 共享内存
- 与其他进程共享的内存大小，包括共享内存，动态链接库，代码段

### mmap [Linux中的mmap映射 [一]](https://zhuanlan.zhihu.com/p/67894878)
- 匿名映射
  - 用于对没有文件关联的内容进行映射
  - 共享:典型应用是作为进程间通信机制的POSIX共享内存
  - 私有：可以用来实现glibc中的malloc()，用于分配大块内存
- 命名映射
  - 只是将一个文件的一部分内容映射到了进程虚拟地址空间中的一个VMA区域
  - 两类
    - 共享:修改对所有进程可见
    - 私有:COW，A进程的修改对B进程不可见
### Linux 中free 命令 数据说明
- free available
    - free 是真正尚未被使用的物理内存数量
    - available 是应用程序认为可用内存数量，available = free + buffer + cache (注：只是大概的计算方法)

- buffer:作为buffer cache的内存，是块设备(磁盘)的缓冲区，包括读、写磁盘
- cache :cache: 作为page cache的内存, 文件系统的cache，包括读、写文件

### huge page
- 背景
    - 程序随机访问大片内存趋于，TLB就成为了瓶颈，使用大页会提升性能
    - 此时TLB miss/ L3 Miss比例会很高
    - 更适合有哈希性质程序
- 特点    
    - HugePages are not swappable.不存在内存空间不足，而换入换出
    - 减轻TLB压力
    - 页表项更少，查找更快