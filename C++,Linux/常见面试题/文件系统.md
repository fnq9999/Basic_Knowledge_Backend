文件系统
==================

### 基本结构
- 分区：一个分区一般对应一个文件系统
- 柱面组：在磁盘当中每个盘面上相对位置相同的磁道构成柱面组
- sector:硬盘的存储单位
- block：是文件存取的最小单位，操作系统的对磁盘的抽象，相当于操作系统对内存抽象成page

- 超级块 super_block
    - 存储一个已安装的文件系统的控制信息，代表一个已安装的文件系统
- 索引节点 inode
    - 索引节点对象存储了文件的相关信息，代表了存储设备上的一个实际的物理文件。当一个 文件首次被访问时，内核会在内存中组装相应的索引节点对象，以便向内核提供对一个文件进行操 作时所必需的全部信息；这些信息一部分存储在磁盘特定位置，另外一部分是在加载时动态填充的
        - 文件类型、文件访问权限位、文件长度、指向文件数据块的指针，使用stat可以查看inode信息
    - 要读取一个文件，现在inode当中，查找文件内容所在的block,然后把所有block的内容都读出来。
    - <img src="https://uploadfiles.nowcoder.com/files/20200806/6638786_1596672140375_BSD_disk.png" width="50%">
    
- 目录项 dentry
    - 没有对应的磁盘数据结构，VFS根据字符换形式的路径名现场创建，
    - 作用：为方便查找操作，VFS引入该概念
- 文件对象
    - 已打开文件在内存中的表示
    - 同一个物理文件，可以有多个文件对象
   
### 硬链接和软连接
- 预备知识
    - 目录块也是一种数据块，其中的两个值 '.' 和 '..'分别代表了 当前目录和上级目录，目录块中还可以有文件名，每个文件的文件名都存储在上级目录块当中
- 硬链接
    - 就是在目录块当中创建一个指向同一个inode节点，使得inode节点的链接计数+=1
    - 不可以跨文件系统，因为指向的inode只能是本文件系统的
- 软链接
    - 是一个独立的文件，内容是链接到的文件路径
    - 可以跨文件系统
    
   
### 文件描述符和inode
- 参考：[理解Linux的文件描述符FD与Inode](https://zhuanlan.zhihu.com/p/143430585)
- <img src="https://pic3.zhimg.com/80/v2-9c04a9b4dbb1d6351efb95f12a937b46_720w.jpg" width="50%">
- 每个进程都有自己的进程级别文件描述表。
    - 通过task_struct 中的files指针得到
- 系统级别的文件描述表（打开文件表）
- inode表（在磁盘当中）     
### RWX的理解
- 目录文件如果只有只读没有执行权限的话，那么只能获取文件名，无法获取其他信息。因为其他信息都存储在inode当中，
只有执行权限才能访问inode信息、
### EXT3
- 每个inode节点有15个元素指针
    - 前12个是文件数据在磁盘的地址
    - 13th是间接块的地址
    - 14th是2级间接块
    - 15th是3级间接块
- 缺点就是如果，户写入远大于文件系统块的数据，就要被分成很多块，并且要计算地址，这样效率低。 
    - <img src="https://pic1.zhimg.com/80/v2-6e963ff85bba0edaa23d3a94bc85f2bc_720w.jpg" width="50%">


### EXT4
- 参考：[用了这么多年Ext4文件系统，您知道它的这些高级特性吗？_知乎](https://zhuanlan.zhihu.com/p/58117426)
- 使用B+树
- 具有EXTENT特性，数据只需要记住数据长度，和数据地址，不需要分割，效率极大提升
- 延迟写入，延迟获取磁盘空间：每次写入并不急于写入磁盘，而是写到缓冲区，然后再一起写到磁盘，尽可能将磁盘的随机IO变成顺序IO
- 日志校验和：用来提高文件系统的可靠性





硬盘
=======================
### 基本结构
- 盘片、
    - 一个磁盘有多个盘片，每个盘片可能有两个盘面，每个盘面对应一个磁头，所有的磁头都连载一个磁臂上，所有磁头共进退
    
- 磁道、
    - 磁盘的盘面被分成一个一个圈，这一个个全就是磁道，
- 扇区、
    - 每个磁道又被分成多个扇区，每个扇区的容量都是相同的，
- 柱面
    - 所有盘面中相对位置相同的磁道构成柱面
- 使用(柱面号，盘面号，扇区号)来任意表示一个扇区


### 磁盘响应时间
- 占大头的
    - 寻道时间：磁头移动到数据所在磁道的时间
    - 旋转延迟：盘片旋转直至数据所在扇区到达磁头位置时所对应时间
- 数据传输时间：

### 机械硬盘

### 固态硬盘
















